<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lake Bienne Weather</title>
    <style>
        :root {
            --bg-main: #1a1a1a;
            --bg-alt: #2d2d2d;
            --bg-nav: #1a1a1a;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent: #5dade2;
            --border: #444;
            --rain-bar: #4a90e2;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            touch-action: pan-y;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            font-size: 12px;
        }
        
        nav { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 65px; 
            background: var(--bg-nav); 
            border-bottom: 1px solid var(--border); 
            z-index: 1000; 
        }
        
        .nav-top {
            height: 35px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .nav-title {
            font-size: 14px;
            font-weight: 600;
        }
        
        .refresh-btn {
            margin-left: auto;
            background: none;
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
        }
        
        .hours-bar {
            width: 100%;
            display: flex;
            flex-direction: column;
            padding: 0 20px;
        }
        
        .hours-labels {
            display: flex;
            width: 100%;
            padding: 3px 0;
        }
        
        .hour-label {
            flex: 1;
            text-align: center;
            font-size: 10px;
            color: var(--text-secondary);
        }
        
        .indicators-row {
            width: 100%;
            display: flex;
            height: 10px;
            align-items: center;
        }
        
        .indicator-container {
            flex: 1;
            display: flex;
            justify-content: center;
        }
        
        .indicator-line {
            width: 1px;
            height: 6px;
            background: rgba(255,255,255,0.4);
        }
        
        .container {
            width: 100%;
            max-width: 420px;
            margin: 75px auto 20px;
            padding: 0 10px 20px;
        }
        
        .day-card {
            background: var(--bg-alt);
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .day-header {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--accent);
        }
        
        .section-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-align: center;
            margin: 6px 0 2px;
        }
        
        .data-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
            padding: 2px 0;
        }
        
        .temp-value {
            flex: 1;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
        }
        
        .weather-icon {
            flex: 1;
            text-align: center;
            font-size: 16px;
        }
        
        .rain-chart {
            position: relative;
            height: 35px;
            margin: 6px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .rain-bars {
            display: flex;
            height: 100%;
            align-items: flex-end;
        }
        
        .rain-hour {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }
        
        .rain-stack {
            width: 75%;
            display: flex;
            flex-direction: column;
            gap: 1px;
        }
        
        .rain-bar {
            height: 4px;
            background: var(--rain-bar);
            opacity: 0.8;
        }
        
        .wind-section {
            margin: 6px 0;
        }
        
        .wind-row {
            display: flex;
            font-size: 10px;
            margin-bottom: 1px;
        }
        
        .wind-hour {
            flex: 1;
            text-align: center;
            padding: 1px;
        }
        
        .wind-avg {
            color: var(--text-primary);
        }
        
        .wind-gust {
            color: #ff9999;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-top">
            <div class="nav-title">Wetter Bieler See - Temp, Regen, Wind</div>
            <button class="refresh-btn" onclick="loadWeather()">‚Üª</button>
        </div>
        <div class="hours-bar">
            <div class="hours-labels">
                <div class="hour-label">6</div>
                <div class="hour-label">7</div>
                <div class="hour-label">8</div>
                <div class="hour-label">9</div>
                <div class="hour-label">10</div>
                <div class="hour-label">11</div>
                <div class="hour-label">12</div>
                <div class="hour-label">13</div>
                <div class="hour-label">14</div>
                <div class="hour-label">15</div>
                <div class="hour-label">16</div>
                <div class="hour-label">17</div>
                <div class="hour-label">18</div>
                <div class="hour-label">19</div>
                <div class="hour-label">20</div>
                <div class="hour-label">21</div>
            </div>
            <div class="indicators-row">
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
                <div class="indicator-container"><div class="indicator-line"></div></div>
            </div>
        </div>
    </nav>

    <div class="container" id="weather-container">
        <div class="loading">Wetterdaten laden...</div>
    </div>

    <script>
        const API_URL = 'https://api.open-meteo.com/v1/forecast';
        const LAT = 47.1485;
        const LON = 7.2437;
        
        // Weather code to icon mapping
        const weatherIcons = {
            0: '‚òÄÔ∏è', // Clear sky
            1: 'üå§Ô∏è', // Mainly clear
            2: '‚õÖ', // Partly cloudy
            3: '‚òÅÔ∏è', // Overcast
            45: 'üå´Ô∏è', // Fog
            48: 'üå´Ô∏è', // Rime fog
            51: 'üå¶Ô∏è', // Light drizzle
            53: 'üå¶Ô∏è', // Moderate drizzle
            55: 'üå¶Ô∏è', // Dense drizzle
            61: 'üåßÔ∏è', // Slight rain
            63: 'üåßÔ∏è', // Moderate rain
            65: 'üåßÔ∏è', // Heavy rain
            71: 'üå®Ô∏è', // Slight snow
            73: 'üå®Ô∏è', // Moderate snow
            75: 'üå®Ô∏è', // Heavy snow
            77: 'üå®Ô∏è', // Snow grains
            80: 'üå¶Ô∏è', // Slight rain showers
            81: 'üå¶Ô∏è', // Moderate rain showers
            82: 'üåßÔ∏è', // Violent rain showers
            85: 'üå®Ô∏è', // Slight snow showers
            86: 'üå®Ô∏è', // Heavy snow showers
            95: '‚õàÔ∏è', // Thunderstorm
            96: '‚õàÔ∏è', // Thunderstorm with slight hail
            99: '‚õàÔ∏è'  // Thunderstorm with heavy hail
        };
        
        const dayNames = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
        
        async function loadWeather() {
            try {
                const params = new URLSearchParams({
                    latitude: LAT,
                    longitude: LON,
                    hourly: 'temperature_2m,precipitation_probability,weather_code,wind_speed_10m,wind_gusts_10m',
                    timezone: 'Europe/Zurich',
                    forecast_days: 7
                });
                
                const response = await fetch(`${API_URL}?${params}`);
                const data = await response.json();
                
                displayWeather(data);
            } catch (error) {
                console.error('Error loading weather:', error);
                document.getElementById('weather-container').innerHTML = 
                    '<div class="loading">Fehler beim Laden der Wetterdaten</div>';
            }
        }
        
        function displayWeather(data) {
            const container = document.getElementById('weather-container');
            container.innerHTML = '';
            
            const hourly = data.hourly;
            const now = new Date();
            
            for (let day = 0; day < 7; day++) {
                const dayDate = new Date(now);
                dayDate.setDate(now.getDate() + day);
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                
                // Day header with German format
                const dayName = dayNames[dayDate.getDay()];
                const dateStr = `${dayDate.getDate()}.${dayDate.getMonth() + 1}.${dayDate.getFullYear()}`;
                
                dayCard.innerHTML = `<div class="day-header">${dayName} ${dateStr}</div>`;
                
                // Get hourly data for this day (6:00-21:00)
                const startHour = dayDate.toISOString().slice(0, 10) + 'T06:00';
                const startIndex = hourly.time.findIndex(t => t >= startHour);
                
                if (startIndex === -1) continue;
                
                // Temperature (every 3 hours: 6, 9, 12, 15, 18, 21)
                dayCard.innerHTML += '<div class="section-label">Temperatur</div>';
                const tempRow = document.createElement('div');
                tempRow.className = 'data-row';
                for (let h = 0; h < 16; h += 3) {
                    const idx = startIndex + h;
                    const temp = Math.round(hourly.temperature_2m[idx] || 0);
                    tempRow.innerHTML += `<div class="temp-value">${temp}¬∞</div>`;
                }
                dayCard.appendChild(tempRow);
                
                // Weather icons (every 1.5 hours = 11 values)
                const weatherRow = document.createElement('div');
                weatherRow.className = 'data-row';
                for (let i = 0; i < 11; i++) {
                    const h = Math.round(i * 1.5);
                    const idx = startIndex + h;
                    const icon = weatherIcons[hourly.weather_code[idx]] || '‚ùì';
                    weatherRow.innerHTML += `<div class="weather-icon">${icon}</div>`;
                }
                dayCard.appendChild(weatherRow);
                
                // Rain probability chart
                dayCard.innerHTML += '<div class="section-label">Regen, 1 Strich = 5%</div>';
                const rainChart = document.createElement('div');
                rainChart.className = 'rain-chart';
                const rainBars = document.createElement('div');
                rainBars.className = 'rain-bars';
                
                for (let h = 0; h < 16; h++) {
                    const idx = startIndex + h;
                    const rainProb = hourly.precipitation_probability[idx] || 0;
                    const barCount = Math.min(Math.floor(rainProb / 5), 6);
                    
                    const hourDiv = document.createElement('div');
                    hourDiv.className = 'rain-hour';
                    
                    const stack = document.createElement('div');
                    stack.className = 'rain-stack';
                    
                    for (let b = 0; b < barCount; b++) {
                        stack.innerHTML += '<div class="rain-bar"></div>';
                    }
                    
                    hourDiv.appendChild(stack);
                    rainBars.appendChild(hourDiv);
                }
                
                rainChart.appendChild(rainBars);
                dayCard.appendChild(rainChart);
                
                // Wind section
                dayCard.innerHTML += '<div class="section-label">Wind, Durchschnitt und B√∂en, km/h</div>';
                const windSection = document.createElement('div');
                windSection.className = 'wind-section';
                
                const windAvgRow = document.createElement('div');
                windAvgRow.className = 'wind-row';
                const windGustRow = document.createElement('div');
                windGustRow.className = 'wind-row';
                
                for (let h = 0; h < 16; h++) {
                    const idx = startIndex + h;
                    const windSpeed = Math.round(hourly.wind_speed_10m[idx] || 0);
                    const windGust = Math.round(hourly.wind_gusts_10m[idx] || 0);
                    
                    windAvgRow.innerHTML += `<div class="wind-hour wind-avg">${windSpeed}</div>`;
                    windGustRow.innerHTML += `<div class="wind-hour wind-gust">${windGust}</div>`;
                }
                
                windSection.appendChild(windAvgRow);
                windSection.appendChild(windGustRow);
                dayCard.appendChild(windSection);
                
                container.appendChild(dayCard);
            }
        }
        
        // Prevent double-tap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // Load weather on page load
        loadWeather();
    </script>
</body>
</html>
